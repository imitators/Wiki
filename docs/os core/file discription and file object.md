# 文件描述符

Linux**文件描述符**是linux为跟踪打开文件而分配的一个数字。文件描述符类似于指针，默认指向`/dev/tty0`。

Linux 启动时默认打开三个文件描述符：标准输入 stdin 0，标准输出 stdout 1，标准错误输出 stderr 3。

??? note "`ls /proc/self/fd/`输出0123"
    ∵ POSIX标准要求每次打开文件时必须使用当前进程中最小可用的文件描述符。
    又∵ 正常启动进程后，就会打开默认的三个文件描述符（即123）。如果此时去打开一个新的文件，它的文件描述符会是3。
    ∴ 为了读取`/proc/self/fd`的内容，需要打开这个目录，此时需要一个新的句柄，分配为3

    ps: `/proc/${pid}/fd` 可以查看其他进程的文件描述符

## 重定向

`<`与`>`都是**重定向**符号，分别代表输入重定向，输出重定向。`<`默认是`0<`，`>`默认是`1>`。

> bash执行命令时，先从左到右执行所有重定向符号，最终在去掉重定向符号后执行命令。

`&> file`和`>& file`都是将**标准输出与标准错误输出**都重定向到`file`文件（以写的方式打开）。这两种方法与 `> file 2>&1`完全相同。

`[n]>&[m]`和`[n]<&[m]`都代表**复制**。`[n]>&[m]`是将文件描述符以只写方式从n复制到m，`[n]<&[m]` 是以只读方式从n复制到m。`0>&1`是将标准输入复制到标准输出，也就是把输出复制到输入，这样被控端就不会输出了。

使用**exec绑定重定向**能让重定向对后续指令也能起作用。

!!! note "说人话"
    赋值：`<file >file`
    同时赋两个值：`>&file &>file`
    修改指针指向，指定打开方式：`1>&2 1<&2`
    赋值，指定打开方式：`3<>file`

> shell的内建命令exec将并不启动新的shell，而是用要被执行命令替换当前的shell进程，并且将老进程的环境清理掉，而且exec命令后的其它命令将不再执行。

```shell
exec 3<>file        # 以读写方式打开file，并将n重定向到file，n不指定时默认为0
ls >&3              # 将结果输出重定向到文件描述符3，3的值为file
cat file            # 读取文件file，输出ls命令的结果
```

## 文件描述符操作

```bash
exec 6&>1           # 将6指向1
ls /proc/self/fd/   # 查看文件描述符
exec 6>&-           # 关闭6

exec 3<> test.sh    # *重定向符号和文件之间有无空格都不影响命令执行
exec 3>&-           # 关闭输出绑定
exec 3<&-           # 关闭输入绑定
```

参考资料：

https://blog.csdn.net/qq_35733751/article/details/80699521